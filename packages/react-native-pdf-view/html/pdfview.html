<!DOCTYPE html>
<html lang="en">
<head>
  <style>
    body, html {
      margin: 0;
      padding: 0;
    }
  </style>
  <script>
    const pdfData =
      'JVBERi0xLjcKCjEgMCBvYmogICUgZW50cnkgcG9pbnQKPDwKICAvVHlwZSAvQ2F0YWxvZwog' +
      'IC9QYWdlcyAyIDAgUgo+PgplbmRvYmoKCjIgMCBvYmoKPDwKICAvVHlwZSAvUGFnZXMKICAv' +
      'TWVkaWFCb3ggWyAwIDAgMjAwIDIwMCBdCiAgL0NvdW50IDEKICAvS2lkcyBbIDMgMCBSIF0K' +
      'Pj4KZW5kb2JqCgozIDAgb2JqCjw8CiAgL1R5cGUgL1BhZ2UKICAvUGFyZW50IDIgMCBSCiAg' +
      'L1Jlc291cmNlcyA8PAogICAgL0ZvbnQgPDwKICAgICAgL0YxIDQgMCBSIAogICAgPj4KICA+' +
      'PgogIC9Db250ZW50cyA1IDAgUgo+PgplbmRvYmoKCjQgMCBvYmoKPDwKICAvVHlwZSAvRm9u' +
      'dAogIC9TdWJ0eXBlIC9UeXBlMQogIC9CYXNlRm9udCAvVGltZXMtUm9tYW4KPj4KZW5kb2Jq' +
      'Cgo1IDAgb2JqICAlIHBhZ2UgY29udGVudAo8PAogIC9MZW5ndGggNDQKPj4Kc3RyZWFtCkJU' +
      'CjcwIDUwIFRECi9GMSAxMiBUZgooSGVsbG8sIHdvcmxkISkgVGoKRVQKZW5kc3RyZWFtCmVu' +
      'ZG9iagoKeHJlZgowIDYKMDAwMDAwMDAwMCA2NTUzNSBmIAowMDAwMDAwMDEwIDAwMDAwIG4g' +
      'CjAwMDAwMDAwNzkgMDAwMDAgbiAKMDAwMDAwMDE3MyAwMDAwMCBuIAowMDAwMDAwMzAxIDAw' +
      'MDAwIG4gCjAwMDAwMDAzODAgMDAwMDAgbiAKdHJhaWxlcgo8PAogIC9TaXplIDYKICAvUm9v' +
      'dCAxIDAgUgo+PgpzdGFydHhyZWYKNDkyCiUlRU9G';
    window.ReactNativeWebView = {
      injectedObjectJson() {
        return JSON.stringify({
          data: pdfData,
          pageNumber: 1,
        });
      },
      postMessage(...args) {
        console.log(...args);
      },
    };
  </script>
  <script type="module" src="//cdnjs.cloudflare.com/ajax/libs/pdf.js/4.8.69/pdf.min.mjs"></script>
  <script type="module">
    const { pdfjsLib } = /** @type {{ pdfjsLib: typeof import('pdfjs-dist') }} */ (globalThis);

    pdfjsLib.GlobalWorkerOptions.workerSrc = '//cdnjs.cloudflare.com/ajax/libs/pdf.js/4.8.69/pdf.worker.min.mjs';
    const renderPdfAsync = async () => {

      const stored = JSON.parse(window.ReactNativeWebView.injectedObjectJson());

      let pdfDocument;
      if (stored.data) {
        pdfDocument = await pdfjsLib.getDocument({ data: atob(stored.data) }).promise;
      } else if (stored.uri) {
        pdfDocument = await pdfjsLib.getDocument(stored.uri).promise;
      } else {
        throw Error('unable to load data');
      }
      const pdfPage = await pdfDocument.getPage(stored.pageNumber);
      /** @type {HTMLCanvasElement} */
      const canvasElement = document.getElementById('canvas');
      const viewport = pdfPage.getViewport({ scale: 1.5 });
      canvasElement.height = viewport.height;
      canvasElement.width = viewport.width;

      await pdfPage.render({
        canvasContext: canvasElement.getContext('2d'),
        viewport: viewport,
      }).promise;
      return { '_': 'ok' };
    };
    window.onload = (event) => {
      if (window.ReactNativeWebView.injectedObjectJson()) {
        renderPdfAsync()
          .then(
            (message) => {
              window.ReactNativeWebView.postMessage(
                JSON.stringify(message),
              );
            },
          )
          .catch(
            (error) => {
              window.ReactNativeWebView.postMessage(
                JSON.stringify(
                  {
                    '_': 'error',
                    'error': error.message ?? error,
                  },
                ),
              );
            },
          );
      }
    };
  </script>
</head>
<body>
<canvas id="canvas"></canvas>
</body>
</html>
